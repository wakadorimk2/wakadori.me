# AI_GUIDE.md

本ドキュメントは、このリポジトリにおける **AI 向けルールの正本（single source of truth）** です。  
AI は必ず最初にここを読み、判断に迷った場合は本ドキュメントへ戻ってください。

---

## TL;DR（最重要要約）

- AI向けルールの正本は `AI_GUIDE.md` のみ
- 理念層は判断軸、規約層は **必須**
- このUIは「完成形」ではなく **入口（entry point）**
- 変更は小さく、静けさ・余白・触感を最優先
- モード差分は **見せ方のみ変更可／意味変更不可**
- プレースホルダー・余白・沈黙は意図。勝手に埋めない
- AIは **提案 → diff → 承認 → 実装** の順を厳守

---

## 目的 / スコープ

- このUIは自己紹介の完成形ではなく、**体験への入口**として設計されている
- 情報量・機能追加より、**静けさ・余白・触感・視線誘導**を重視する
- Front / Back / Shelf 等の切替は、情報追加ではなく **視点の切替**
- AIの役割は、設計思想を壊さずに調整・実装・レビューを補助すること
- 技術スタックは静的サイト（HTML / CSS / 最小限の JS）
- デプロイは Cloudflare Pages

---

## 理念層（推奨・判断軸）

### 情報と主従
- **主役の情報**: 丸いアバター画像と日本語名「わかどり」
- 英字名・肩書き・補足情報は控えめに扱う
- テキストは説明ではなく「空気感・活動の気配」を示す

### 見せ方
- リンク量は最小限（Illustration / Tech 程度）
- 情報を増やすより、**見せない選択**を優先
- 演出（3D / 光沢 / Orb / 影 / 半透明）はすべて意味を持つ

### 余白と沈黙
- 余白・プレースホルダーは **将来の余地として意図的**
- 何もない状態もUIの一部
- 迷ったら **gentler / quieter / less intrusive** を選ぶ

---

## 規約層（必須ルール）

### モード境界ルール（必須）

このUIには複数のモード（例: 通常 / PC棚）が存在する。

- モードは **見せ方（layout / presentation）を変えてよい**
- モードは **意味・役割・主従を変えてはならない**
- モードごとに無効化される挙動は、必ず明示的にガードすること
  - early return / 条件分岐 など
- モードごとに再付与される挙動は、責務レベルを明確にすること

禁止:
- 「このモードでは壊れてもよい」という判断
- DOM配置や偶然に依存した挙動成立

---

### 責務の階層（必須）

インタラクションや演出は、次の階層を尊重する。

- **World / Container**
  - レイアウト、配置、静けさ
  - 原則として transform / tilt を持たない
- **Item / Tile**
  - 強調、軽微な動き、注目
- **Media**
  - 視覚変形のみ（transform はここに適用）

例:
- 棚（world）は傾かない
- 棚タイル（item）は個別に傾いてよい
- transform は layout コンテナではなく内側要素に適用する

---

### Reparent / モード切替の安全ルール（必須）

DOM要素をモード間で移動・再配置する場合:

- clone より **既存ノードの移動**を優先
- 必ず元に戻せる経路を保持する（placeholder / 参照Map）
- モードON/OFFを複数回切替えても挙動が増殖しないこと
- 追加した event / style / state は OFF 時に必ず解除

モード切替は常に:
- reversible
- repeatable
- side-effect free
でなければならない

---

### 絶対にやらないこと（禁止）

- 勝手な仕様変更・機能追加
- 新しい AI 向け md の追加（正本は `AI_GUIDE.md` のみ）
- 意図不明な余白・演出の削除
- 関係のないコードのリファクタ
- 大規模リファクタ（必要時は事前相談）

---

### 危険箇所（要事前承認）

以下は壊れやすい領域。変更時は **理由・影響範囲を説明し承認を得ること**。

1. **Orb効果**（`.wk-orb-*`）
2. **フォーカス管理**（a11y 関連）
3. **inert処理**（旧ブラウザ含む）
4. **3Dフリップ**（WebKit ハック含む）

---

### diff と承認ルール

- **必ず diff を提示してから実装**
- 構造判断に迷いがある場合は先に質問
- 説明は簡潔に、意図と影響を示す

---

### 変更の粒度

- 小さな調整を優先
- DOM構造変更は **明示的指示がある場合のみ**
- デスクトップレイアウトは原則変更しない

---

### モバイル変更ルール

- メディアクエリ内に限定
- 目的は余白・操作安全性の改善のみ
- レイアウト再構成は禁止

---

### 静けさ・演出の制約（必須）

- ランダム性・過剰なアニメーションは禁止
- 複数同時演出は禁止
- 演出は「無視しても成立する」こと

---

### AI判断停止ルール

- モード境界・責務階層に迷ったら **実装を止めて質問**
- 「直せそうだから直す」は理由にならない

---

## 作業フロー（必須）

1. 調査
2. 提案（diff）
3. 承認
4. 実装
5. 検証
6. 提示（diff＋意図）

---

## 実行してよいコマンド

- AIが勝手に実行しない
- Claude: `.claude/settings.local.json` に従う
- Copilot: `.github/copilot-instructions.md` に従う
- 追加実行は提案 → 承認

---

## 参照

- README.md（人間向け設計意図）
- CLAUDE.md
- .github/copilot-instructions.md

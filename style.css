:root{
  --bg:#fff7fb;
  --fg:#16161a;
  --muted:#6b6172;
  --pill:#ffffff;
  --border:rgba(22,22,26,.10);
  --accent:#d85aa6;
  --orb-grain-opacity: 0.14;
  --orb-blotch-opacity: 0.12;
  --orb-highlight-opacity: 0.45;
  --orb-highlight-hover: 0.65;
  --orb-highlight-shift: 2%;
  --orb-inner-offset: 0.7px;
  --orb-inner-scale: 0.78;
  --orb-inner-offset-x: var(--orb-inner-offset);
  --orb-inner-offset-y: calc(var(--orb-inner-offset) * -0.6);
  --orb-inner-opacity: 0.72;
  --orb-inner-shift: 0.8px;
  --orb-aurora-opacity: 0.55;
  --orb-glitter-opacity: 0.30;
  --orb-reflect-opacity: 0.30;
  --card-radius:28px;
  --card-shadow: 0 24px 60px rgba(22,22,26,.18), 0 6px 16px rgba(22,22,26,.10);
  --page-bg:
    radial-gradient(1200px 600px at 20% 10%, rgba(216,90,166,.10), transparent 60%),
    radial-gradient(900px 500px at 80% 0%, rgba(70,130,255,.10), transparent 55%),
    var(--bg);
}

/* Registered custom properties for independent transition control.
   --flip: animated (flip card); --tilt-x/y: instant (pointer tilt). */
@property --flip {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0deg;
}

@property --tilt-x {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0deg;
}

@property --tilt-y {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0deg;
}

@property --lift {
  syntax: "<length>";
  inherits: false;
  initial-value: 0px;
}

*{
  box-sizing: border-box;
}

html, body{
  height:100%;
}

body{
  margin:0;
  background: var(--page-bg);
  color:var(--fg);
  line-height:1.8;
  font-family:
    ui-rounded,
    "Hiragino Maru Gothic ProN",
    "SF Pro Rounded",
    system-ui,
    -apple-system,
    "Hiragino Sans",
    "Noto Sans JP",
    sans-serif;
  overflow-x:auto;
}

.wk-scene{
  width:100%;
  height:100vh;
  perspective: clamp(600px, 100vw, 1400px);
  position:relative;
  padding: clamp(14px, 2vw, 28px);
}

.wk-card-shell{
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  isolation: isolate;
  touch-action: none; /* Pointer tilt uses pointermove; touch is handled via MQ overrides. */
  /* Orb + cutout alignment variables (used by the orb and the visual cutout ::after element). */
  --orb-size: clamp(96px, 20vw, 144px);
  --orb-core-scale: 0.6;
  --orb-bottom: clamp(12px, 2.2vw, 22px);
  --orb-cutout-gap: 6px;
  --orb-core-size: calc(var(--orb-size) * var(--orb-core-scale));
  --orb-hole-radius: calc((var(--orb-core-size) / 2) + var(--orb-cutout-gap));
  --orb-center-x: 50%;
  --orb-center-y: calc(100% - var(--orb-bottom) - (var(--orb-size) / 2));
  /* Pointer glow variables (controlled by JS). */
  --px: 50%;
  --py: 50%;
  --glow-a: 0;
}

/* Pointer glow overlay (radial gradient follows pointer). */
.wk-card-shell::before{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  background: radial-gradient(
    circle at var(--px) var(--py),
    rgba(255, 255, 255, 0.28),
    transparent 50%
  );
  opacity: var(--glow-a);
  transition: opacity 200ms ease-out;
  pointer-events: none;
  /* z-index 10: above card faces so glow is visible; pointer-events:none ensures no interaction blocking. */
  z-index: 10;
}

.wk-card-rotator{
  position:relative;
  width:100%;
  height:100%;
  /* 3D flip container: front/back faces live inside this rotator. */
  transform-style:preserve-3d;
  --flip: 0deg;
  --tilt-x: 0deg;
  --tilt-y: 0deg;
  --lift: 0px;
  transform-origin: 50% 50%;
  /* Rotation order: rotateY(flip) first, then tilt-x/tilt-y in the card's local coords.
     The second rotateY applies after flip so tilt feels natural on both faces. */
  transform: rotateY(var(--flip)) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) translateZ(var(--lift));
  /* Transition --flip (not transform) so tilt responds instantly while flip animates.
     Fallback: browsers without @property support get no flip animation (acceptable degradation). */
  transition:
    --flip .6s cubic-bezier(0.4, 0.0, 0.2, 1),
    --tilt-x 150ms ease-out,
    --tilt-y 150ms ease-out,
    --lift 150ms ease-out,
    box-shadow .6s cubic-bezier(0.4, 0.0, 0.2, 1);
  border-radius: var(--card-radius);
  box-shadow: var(--card-shadow);
  z-index: 1;
}

/* Instant tilt response while pointer is down. */
.wk-card-rotator.is-tilting{
  transition: --flip .6s cubic-bezier(0.4, 0.0, 0.2, 1), box-shadow .6s cubic-bezier(0.4, 0.0, 0.2, 1);
}

/* Debug mode (temporary): uncomment to verify face visibility.
.wk-front{ background: rgba(255, 80, 80, .25); }
.wk-back{ background: rgba(80, 120, 255, .25); }
*/

.wk-surface{
  position: absolute;
  inset: 0;
  border-radius: var(--card-radius);
  transform-style: preserve-3d;
}

.wk-surface::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: var(--card-radius);
  z-index:1;
  background: linear-gradient(120deg, transparent 10%, rgba(255,255,255,.55) 50%, transparent 90%);
  opacity:0;
  transform: translateX(-25%);
  transition: opacity .6s cubic-bezier(0.4, 0.0, 0.2, 1), transform .6s cubic-bezier(0.4, 0.0, 0.2, 1);
  pointer-events:none;
}

.wk-card-rotator.is-flipped{
  --flip: 180deg;
  box-shadow: 0 28px 70px rgba(22,22,26,.22), 0 6px 18px rgba(22,22,26,.12);
}

.wk-card-rotator.is-flipped .wk-surface::before{
  opacity:.7;
  transform: translateX(25%);
}

/* CSS mask breaks 3D backface rendering in practice; use a stable visual cutout instead. */
.wk-surface::after{
  content: "";
  position: absolute;
  width: calc(var(--orb-hole-radius) * 2);
  height: calc(var(--orb-hole-radius) * 2);
  left: var(--orb-center-x);
  top: var(--orb-center-y);
  transform: translate(-50%, -50%);
  border-radius: 50%;
  background: var(--bg);
  z-index: 4;
  pointer-events: none;
  /* Socket shadow: creates depth behind the orb to prevent white washout. */
  box-shadow:
    inset 0 4px 12px rgba(22,22,26,.18),
    inset 0 0 0 1px rgba(255,255,255,.5),
    0 2px 6px rgba(22,22,26,.10);
}

.wk-face{
  position:absolute;
  inset:0;
  border-radius: var(--card-radius);
  z-index:2;
  background: rgba(255,255,255,.70);
  /* Backdrop blur is disabled intentionally for performance and broader browser compatibility. */
  /* -webkit-backdrop-filter: blur(16px); */
  /* backdrop-filter: blur(16px); */
  border: 1px solid var(--border);
  /* フレーム表現：フレーム帯 + 面取り */
  box-shadow:
    /* ── 外側から順に ── */
    /* 1. 外縁暗線（カード全体の境界） */
    0 0 0 0.5px rgba(22,22,26,.1),
    /* 2. フレーム帯ハイライト（上寄せ、厚みの光沢面） */
    0 -0.5px 0 2px rgba(255,255,255,.2),
    /* 3. フレーム帯本体（薄いトーン、約4px幅） */
    0 0 0 6px rgba(248, 245, 252, 0.42),
    /* 4. 隙間線（フレーム帯の内側境界） */
    0 0 0 7px rgba(22,22,26,.055),
    /* ── 内側 ── */
    /* 5. 内縁ハイライト（面取り、上寄せ） */
    inset 0 1px 0 1px rgba(255,255,255,.28),
    /* 6. 内側沈み影（フレームに沈む感じ） */
    inset 0 2px 5px rgba(22,22,26,.04);
  backface-visibility:hidden;
  -webkit-backface-visibility: hidden;
  transform-style:preserve-3d;
  overflow:hidden;
}

.wk-front{
  transform: rotateY(0deg);
}

.wk-back{
  transform: rotateY(180deg);
  background: linear-gradient(160deg, rgba(255,255,255,.92), rgba(255,255,255,.76));
}

.wk-face-inner{
  height:100%;
  overflow-y:auto;
  scrollbar-gutter: stable; /* Keeps layout from shifting when scrollbars appear/disappear. */
  padding: clamp(22px, 4vw, 56px);
}

.wk-main{ width:100%; min-height:100%; }
.wk-front-content{ max-width:720px; margin: 0 auto; }
h1{ margin:0 0 10px; font-size: clamp(34px, 4vw, 46px); }
h2{ margin: 26px 0 10px; font-size: 16px; color: var(--muted); }

ul{ list-style:none; padding:0; margin: 12px 0 0; display:flex; flex-direction:column; gap:12px; }

a{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 14px 16px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,.70);
  backdrop-filter: blur(10px);
  border-radius: 999px;
  color: var(--fg);
  text-decoration:none;
}

/* iOS WebKit: prevent specific link elements from bleeding through the backface. */
.wk-face a{
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  transform: translateZ(0.01px);
  -webkit-transform: translateZ(0.01px);
}

.link-content{
  display:flex;
  align-items:center;
  gap:10px;
}

.thumb{
  width:36px;
  height:36px;
  border-radius:10px;
  object-fit:cover;
  opacity: 0.85;
  background:#fff;
  border:1px solid rgba(22,22,26,.08);
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}

a:hover{ border-color: rgba(216,90,166,.35); }

h1{
  font-weight: 700;
  letter-spacing: -0.01em;
}

a::after{
  content: "→";
  color: var(--accent);
  font-size: 24px;
  font-weight: 800;
  line-height: 1;
  opacity: .6;
  transition: transform .15s ease, opacity .15s ease;
}
a:hover::after{
  transform: translateX(4px);
  opacity: 1;
}

.name{
  margin: 0 0 20px;
  line-height: 1.3;
}

.name .jp{
  display: block;
  font-size: clamp(40px, 6vw, 56px);
  font-weight: 800;
  letter-spacing: -0.02em;
  color: var(--fg);
}

.name .en{
  display: block;
  margin-top: 6px;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: .08em;
  color: var(--muted);
}

.hero{
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 28px;
}

.name-text{
  display: flex;
  flex-direction: column;
}


.avatar{
  width: 56px;
  height: 56px;
  border-radius: 50%;
  object-fit: cover;
  background: #fff;
  border: 0.5px solid rgba(36, 33, 33, 0.06);
  box-shadow:
    0 2px 12px rgba(32, 26, 26, 0.1),
    0 0 0 2px rgba(247, 187, 205, 0.65);
}

.wk-hero{
  margin: 10px 0 24px;
}

.wk-lead{
  margin: 0 0 16px;
  color: var(--muted);
  font-size: 15px;
}

.wk-entry{
  margin-top: 4px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.wk-entry-actions{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

.wk-entry-button{
  border: 1px solid rgba(22,22,26,.12);
  background: rgba(255,255,255,.78);
  border-radius: 999px;
  padding: 16px 18px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
  font-family: inherit;
  color: var(--fg);
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(22,22,26,.08);
  transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease;
}

.wk-entry-button:hover{
  transform: translateY(-1px);
  border-color: rgba(216,90,166,.35);
  box-shadow: 0 12px 28px rgba(22,22,26,.12);
}

.wk-entry-button:focus-visible{
  outline: none;
  border-color: rgba(216,90,166,.5);
  box-shadow: 0 0 0 2px rgba(255,255,255,.9), 0 0 0 4px rgba(216,90,166,.28);
}

.wk-entry-button.is-code{
  border-color: rgba(70,130,255,.28);
}

.wk-entry-label{
  font-weight: 700;
  font-size: 16px;
}

.wk-entry-sub{
  font-size: 12px;
  color: var(--muted);
  letter-spacing: .08em;
}

.wk-portal{
  position: relative;
  padding: 16px;
  border-radius: 22px;
  border: 1px solid rgba(22,22,26,.10);
  background: rgba(255,255,255,.72);
  box-shadow: 0 18px 40px rgba(22,22,26,.12);
  transform: translateY(-2px);
}

.wk-portal-inner{
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.wk-portal-image{
  width: 88px;
  height: 88px;
  border-radius: 18px;
  object-fit: cover;
  border: 1px solid rgba(22,22,26,.1);
  box-shadow: 0 8px 20px rgba(22,22,26,.12);
  background: #fff;
}

.wk-portal-body{
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1 1 220px;
}

.wk-portal-lead{
  margin: 0;
  color: var(--muted);
  font-size: 14px;
}

.wk-portal-link{
  align-self: flex-start;
  padding: 10px 14px;
  font-size: 14px;
}

.wk-portal-link::after{
  font-size: 18px;
}

.wk-back-links{
  max-width: 720px;
  margin: 0 auto 24px;
}

.wk-back-note{
  margin: 0 0 10px;
  font-size: 13px;
  color: var(--muted);
}

.wk-back-linklist{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
}

@media (max-width: 380px){
  .wk-back-linklist{
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  }
}

.wk-back-linklist a{
  justify-content: space-between;
  padding: 12px 14px;
}

.wk-orb-toggle{
  position:absolute;
  left: var(--orb-center-x); /* Center with translateX so scrollbar width doesn't affect horizontal position. */
  bottom: var(--orb-bottom);
  transform: translateX(-50%) translateZ(0);
  width: var(--orb-size);
  height: var(--orb-size);
  border-radius: 999px;
  border: 0;
  background: transparent;
  padding: 0;
  cursor: pointer;
  z-index: 6;
  display: grid;
  place-items: center;
  touch-action: manipulation;
}

.wk-orb-core{
  position: relative;
  overflow: hidden;
  width: calc(var(--orb-core-scale) * 100%);
  height: calc(var(--orb-core-scale) * 100%);
  border-radius: 50%;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,255,.7), rgba(255,255,255,.3) 40%, transparent 65%),
    radial-gradient(90% 70% at 15% 25%, rgba(255,140,180,var(--orb-aurora-opacity)) 0 30%, transparent 50%),
    radial-gradient(90% 80% at 80% 22%, rgba(120,200,255,var(--orb-aurora-opacity)) 0 28%, transparent 50%),
    radial-gradient(75% 65% at 88% 48%, rgba(255,220,120,var(--orb-aurora-opacity)) 0 24%, transparent 46%),
    radial-gradient(80% 70% at 72% 72%, rgba(100,230,170,var(--orb-aurora-opacity)) 0 25%, transparent 48%),
    radial-gradient(90% 80% at 22% 75%, rgba(175,140,255,var(--orb-aurora-opacity)) 0 28%, transparent 50%),
    radial-gradient(60% 50% at 50% 45%, rgba(255,160,200,calc(var(--orb-aurora-opacity) * 0.4)) 0 18%, transparent 42%),
    radial-gradient(circle at 50% 50%, rgba(232,242,255,.82), rgba(222,235,250,.55) 50%, rgba(205,220,242,.38) 100%);
  box-shadow:
    /* 内側ハイライト（既存） */
    inset 0 0 0 1px rgba(255,255,255,.7),
    /* 内側下部の影（既存） */
    inset 0 -6px 14px rgba(22,22,26,.22),
    /* ベゼル内縁：薄いハイライト（面取り感） */
    0 0 0 0.5px rgba(255,255,255,.18),
    /* 外周暗線：隙間感（部品境界） */
    0 0 0 1.25px rgba(22,22,26,.2),
    /* 外側の影（既存） */
    0 6px 14px rgba(22,22,26,.22);
  transition: transform .2s ease, box-shadow .2s ease;
}

.wk-orb-core::before{
  content: "";
  position: absolute;
  inset: 3%;
  border-radius: inherit;
  z-index: 1;
  background:
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.65) 0%, rgba(255,255,255,.4) 35%, rgba(255,255,255,.15) 60%, transparent 80%),
    radial-gradient(90% 90% at 62% 70%, rgba(22,22,26,.12) 0 28%, transparent 65%),
    radial-gradient(120% 120% at 18% 78%, rgba(255,255,255,calc(var(--orb-glitter-opacity) * 0.4)) 0 18%, transparent 55%),
    radial-gradient(110% 110% at 78% 22%, rgba(210,240,255,calc(var(--orb-glitter-opacity) * 0.35)) 0 16%, transparent 52%),
    radial-gradient(140% 140% at 62% 72%, rgba(255,220,245,calc(var(--orb-glitter-opacity) * 0.3)) 0 18%, transparent 55%);
  opacity: var(--orb-inner-opacity);
  transform: translate(var(--orb-inner-offset-x), var(--orb-inner-offset-y)) scale(var(--orb-inner-scale));
  transition: transform .22s ease .04s, opacity .2s ease;
  pointer-events: none;
}

.wk-orb-core::after{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  z-index: 2;
  background:
    radial-gradient(8% 8% at 28% 22%, rgba(255,255,255,.95) 0 40%, transparent 100%),
    radial-gradient(5% 5% at 35% 28%, rgba(255,255,255,.8) 0 50%, transparent 100%),
    radial-gradient(4% 4% at 68% 35%, rgba(255,255,255,.7) 0 50%, transparent 100%),
    radial-gradient(140% 100% at 22% 18%, rgba(255,255,255,var(--orb-reflect-opacity)) 0 28%, transparent 56%),
    radial-gradient(120% 120% at 80% 88%, rgba(255,255,255,calc(var(--orb-reflect-opacity) * 0.35)) 0 22%, transparent 55%),
    linear-gradient(140deg, rgba(255,255,255,calc(var(--orb-reflect-opacity) * 0.4)) 0%, transparent 44%);
  transform: translate(0, 0);
  transition: transform .2s ease, opacity .2s ease;
  opacity: 1;
  pointer-events: none;
}

.wk-orb-toggle:hover .wk-orb-core{
  transform: translateY(-1px);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.7),
    inset 0 -4px 8px rgba(22,22,26,.14),
    0 0 0 0.5px rgba(255,255,255,.18),
    0 0 0 1.25px rgba(22,22,26,.2),
    0 8px 14px rgba(22,22,26,.2);
}

.wk-orb-toggle:hover .wk-orb-core::after{
  transform: translate(calc(var(--orb-highlight-shift) * -1), calc(var(--orb-highlight-shift) * -1));
  opacity: var(--orb-highlight-hover);
}

.wk-orb-toggle:hover .wk-orb-core::before{
  transform: translate(calc(var(--orb-inner-offset-x) + var(--orb-inner-shift)), calc(var(--orb-inner-offset-y) - var(--orb-inner-shift))) scale(var(--orb-inner-scale));
}

.wk-orb-toggle:active .wk-orb-core::before{
  transform: translate(calc(var(--orb-inner-offset-x) - (var(--orb-inner-shift) * 0.6)), calc(var(--orb-inner-offset-y) + (var(--orb-inner-shift) * 0.6))) scale(var(--orb-inner-scale));
}

.wk-orb-toggle:focus-visible{
  outline: none;
}

.wk-orb-toggle:focus-visible .wk-orb-core{
  box-shadow:
    0 0 0 2px rgba(255,255,255,.9),
    0 0 0 4px rgba(216,90,166,.45),
    inset 0 0 0 1px rgba(255,255,255,.7),
    inset 0 -4px 8px rgba(22,22,26,.12),
    0 0 0 0.5px rgba(255,255,255,.18),
    0 0 0 1.25px rgba(22,22,26,.2),
    0 8px 16px rgba(22,22,26,.18);
}

.wk-back-hero{
  max-width: 720px;
  margin: 0 auto 28px;
}

.wk-kicker{
  margin: 0 0 6px;
  text-transform: uppercase;
  letter-spacing: .24em;
  font-size: 12px;
  color: var(--muted);
}

.wk-title{
  margin: 0 0 8px;
  font-size: clamp(28px, 5vw, 40px);
}

.wk-snapshots{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
  margin: 0 auto 28px;
  max-width: 920px;
}

.wk-shot{
  padding: 16px;
  border-radius: 20px;
  border: 1px dashed rgba(22,22,26,.16);
  background: rgba(255,255,255,.65);
}

.wk-shot-label{
  display:block;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 10px;
}

.wk-shot-frame{
  height: 160px;
  overflow: hidden;
  border-radius: 14px;
  background:
    linear-gradient(135deg, rgba(216,90,166,.12), rgba(70,130,255,.12)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.8) 0 12px, rgba(255,255,255,.35) 12px 24px);
  border: 1px solid rgba(22,22,26,.08);
}

.wk-shot-preview{
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}


@media (max-width: 480px) and (min-height: 701px) and (hover: none) and (pointer: coarse){
  /* 通常モバイル (高さに余裕がある): 内部スクロールを無効化し、ページスクロールに統一 */
  /* Keep 3D structure (absolute + preserve-3d). Stabilize via height/overflow only. */
  .wk-face{
    overflow: hidden;
  }

  .wk-face-inner{
    height: auto;
    max-height: none;
    overflow-y: visible;
    -webkit-overflow-scrolling: auto;
    scrollbar-gutter: auto;
  }

  .wk-scene{
    height: 100svh;
    min-height: 100svh;
    width: 100%;
    max-width: 100%;
  }

  .wk-card-shell,
  .wk-card-rotator{
    height: 100%;
    max-width: 100%;
  }

  .wk-surface,
  .wk-face{
    max-width: 100%;
  }

  /* Horizontal overflow fixes: constrain flex/grid children and allow shrinking. */
  .wk-front-content,
  .wk-back-links,
  .wk-snapshots,
  .wk-entry,
  .wk-entry-actions,
  .wk-portal-inner,
  .wk-portal-body,
  .wk-back-linklist,
  .wk-shot,
  .wk-portal,
  .wk-entry-button{
    min-width: 0;
    max-width: 100%;
  }

  .wk-snapshots{
    grid-template-columns: minmax(0, 1fr);
  }

  .wk-back-linklist{
    grid-template-columns: minmax(0, 1fr);
  }

  .wk-portal-image{
    max-width: 100%;
  }

  /* 例外: wk-portal 展開時のみ内部スクロールを許可 */
  @supports selector(:has(*)){
    .wk-face-inner:has(.wk-portal:not([hidden])){
      height: 100%;
      max-height: 100svh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-gutter: stable;
    }
  }

  /* Fallback: :has 未対応環境ではポータル内だけスクロール */
  @supports not selector(:has(*)){
    .wk-portal:not([hidden]){
      max-height: calc(100svh - 120px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  }
}

@media (max-height: 700px) and (hover: none) and (pointer: coarse){
  /* 小画面モバイル: レイアウトの見切れを避けるため内部スクロールを許容 */
  .wk-face{
    overflow: hidden;
  }

  .wk-face-inner{
    height: 100%;
    max-height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-gutter: stable;
  }
}

@media (hover: none) and (pointer: coarse){
  /* Touch devices: avoid blocking scroll/gesture with tilt-only touch-action. */
  .wk-card-shell{
    touch-action: manipulation;
  }
}


@media (max-width: 720px){
  .wk-scene{
    /* モバイルは安全領域のみ加算 */
    padding-top: calc(clamp(14px, 2vw, 28px) + env(safe-area-inset-top));
  }
  .wk-face-inner{ padding: 20px; }
  .wk-entry-actions{ grid-template-columns: 1fr; }
  .wk-portal-inner{ flex-direction: column; align-items: flex-start; }

  /* 1) ボタン縦方向圧縮 */
  .wk-entry-button{
    padding: 11px 18px;
    line-height: 1.4;
  }

  /* 2) entry / actions の gap 縮小 */
  .wk-entry{ gap: 10px; }
  .wk-entry-actions{ gap: 10px; }

  /* 3) iOS ズーム誘発抑制 */
  .wk-portal-link{ font-size: 16px; }

  .wk-entry-button,
  .wk-portal-link,
  .wk-back-linklist a{
    touch-action: manipulation;
  }

  /* Mobile: expand tap target without changing visual size. */
  .wk-deck .wk-deck-card{
    position: relative;
    box-sizing: content-box;
    padding: 6px;
    margin: -6px;
  }
}
@media (prefers-reduced-motion: reduce){
  .wk-card-rotator,
  .wk-surface::before,
  .wk-orb-core,
  .wk-orb-core::before,
  .wk-orb-core::after,
  .wk-card-shell::before,
  .wk-deck-card{
    transition: none !important;
  }

  .wk-orb-toggle:hover .wk-orb-core::after{
    transform: none;
    opacity: var(--orb-highlight-opacity);
  }

  .wk-orb-toggle:hover .wk-orb-core::before{
    transform: translate(var(--orb-inner-offset-x), var(--orb-inner-offset-y)) scale(var(--orb-inner-scale));
  }
}

/* ========================================
   Deck (inline layout)
   ======================================== */
.wk-deck{
  position: relative;
}

.wk-deck-card{
  cursor: pointer;
}

/* モーション削減対応（上段に統合） */

/* ========================================
   Holder Expression (page as card stack)
   ======================================== */

.wk-scene {
  position: relative; /* Ensure pseudo-elements position correctly */
}

.wk-scene > * {
  position: relative;
  z-index: 1; /* Keep all children above holder pseudo-elements */
}

.wk-scene::before,
.wk-scene::after {
  content: "";
  position: absolute;
  inset: clamp(14px, 2vw, 28px);
  border-radius: var(--card-radius);
  border: 1px solid rgba(22,22,26,.06);
  background: rgba(255,255,255,.25);
  pointer-events: none;
  z-index: 0; /* Behind all content */
}

.wk-scene::before {
  transform: translate(3px, 3px) rotate(0.8deg);
  opacity: 0.5;
}

.wk-scene::after {
  transform: translate(6px, 5px) rotate(1.5deg);
  opacity: 0.3;
}

/* ========================================
   Peek Card Overlay
   ======================================== */

.wk-peek-overlay {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Generous padding to ensure tap-to-close area is comfortable */
  padding: clamp(48px, 10vw, 100px);
}

.wk-peek-overlay[hidden] {
  display: none;
}

.wk-peek-overlay__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(22,22,26,.45);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  cursor: pointer;
}

.wk-peek-overlay__content {
  position: relative;
  width: 100%;
  max-width: min(85vw, 480px);
  max-height: 80vh;
  pointer-events: none;
  display: flex;
  align-items: center;
  justify-content: center;
  /* 3D perspective for card flip */
  perspective: 1000px;
}

.wk-peek-card {
  position: relative;
  pointer-events: auto;
  background: rgba(255,255,255,.96);
  border-radius: var(--card-radius);
  padding: 14px;
  /* Final state: card pops forward */
  box-shadow:
    0 40px 100px rgba(22,22,26,.35),
    0 16px 40px rgba(22,22,26,.20),
    0 0 0 1px rgba(255,255,255,.5);
  transform: rotateY(0deg) translateZ(60px) translateY(0) scale(1);
  transform-style: flat;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  opacity: 1;
  transition:
    transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
    box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.35s ease;
}

.wk-peek-close {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 6px 10px;
  background: rgba(22,22,26,.08);
  color: var(--muted);
  border: 0;
  border-radius: 999px;
  font-size: 12px;
  letter-spacing: 0.03em;
  cursor: pointer;
}

.wk-peek-close:focus-visible {
  outline: 2px solid rgba(216,90,166,.5);
  outline-offset: 2px;
}

/* Opening: card flips in from behind (180deg) and rises */
.wk-peek-overlay.is-opening .wk-peek-card {
  transform: rotateY(-180deg) translateZ(-20px) translateY(40px) scale(0.85);
  box-shadow:
    0 8px 20px rgba(22,22,26,.12),
    0 2px 8px rgba(22,22,26,.08);
  opacity: 0;
}

/* Closing: card flips out */
.wk-peek-overlay.is-closing .wk-peek-card {
  transform: rotateY(180deg) translateZ(-20px) translateY(30px) scale(0.9);
  box-shadow:
    0 8px 20px rgba(22,22,26,.12),
    0 2px 8px rgba(22,22,26,.08);
  opacity: 0;
}

.wk-peek-card:focus {
  outline: none;
  box-shadow:
    0 40px 100px rgba(22,22,26,.35),
    0 16px 40px rgba(22,22,26,.20),
    0 0 0 3px rgba(216,90,166,.45);
}

.wk-peek-card * {
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.wk-peek-card__face {
  display: block;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.wk-peek-card__img {
  display: block;
  max-width: 100%;
  max-height: 70vh;
  border-radius: 16px;
  object-fit: contain;
  /* Hide backface during flip */
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* ========================================
   External Link Dialog
   ======================================== */

.wk-external-dialog {
  position: fixed;
  inset: 0;
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

.wk-external-dialog[hidden] {
  display: none;
}

.wk-external-dialog__backdrop {
  position: absolute;
  inset: 0;
  background: rgba(22,22,26,.5);
  cursor: pointer;
}

.wk-external-dialog__content {
  position: relative;
  background: rgba(255,255,255,.96);
  border-radius: 20px;
  padding: 40px 32px;
  text-align: center;
  box-shadow: 0 24px 60px rgba(22,22,26,.25);
}

.wk-external-dialog__actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.wk-external-dialog__label {
  margin: 0 0 20px;
  color: var(--muted);
  font-size: 14px;
}

.wk-external-dialog__open {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 28px;
  background: var(--accent);
  color: #fff;
  border-radius: 999px;
  font-weight: 600;
  text-decoration: none;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.wk-external-dialog__open:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(216,90,166,.35);
}

.wk-external-dialog__open::after {
  content: "↗";
  font-size: 18px;
}

.wk-external-dialog__cancel {
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size: 13px;
  letter-spacing: 0.03em;
  cursor: pointer;
}

.wk-external-dialog__cancel:focus-visible {
  outline: 2px solid rgba(216,90,166,.5);
  outline-offset: 2px;
}

/* Body scroll lock when peek is open */
body.has-peek-open {
  overflow: hidden;
}

/* Reduced motion: disable 3D flip, use simple fade */
@media (prefers-reduced-motion: reduce) {
  .wk-peek-card {
    transition: opacity 0.2s ease;
    transform: none !important;
  }
  .wk-peek-overlay.is-opening .wk-peek-card,
  .wk-peek-overlay.is-closing .wk-peek-card {
    transform: none !important;
    opacity: 0;
  }
  .wk-peek-overlay.is-open .wk-peek-card {
    opacity: 1;
  }
}
